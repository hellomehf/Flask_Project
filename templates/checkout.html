{% extends 'master.html' %}
{% block content %}
  <main class="pt-90">
    <div class="mb-4 pb-4"></div>
    <section class="shop-checkout container">
      <h2 class="page-title">Shipping and Checkout</h2>
      <div class="checkout-steps">
        <a href="/cart" class="checkout-steps__item active">
          <span class="checkout-steps__item-number">01</span>
          <span class="checkout-steps__item-title">
            <span>Shopping Bag</span>
            <em>Manage Your Items List</em>
          </span>
        </a>
        <a href="/checkout" class="checkout-steps__item active">
          <span class="checkout-steps__item-number">02</span>
          <span class="checkout-steps__item-title">
            <span>Shipping and Checkout</span>
            <em>Checkout Your Items List</em>
          </span>
        </a>

      </div>
      <form  action="/confirm" method="post">
        <div class="checkout-form">
          <div class="billing-info__wrapper">
            <div class="row">
              <div class="col-6">
                <h4>SHIPPING DETAILS</h4>
              </div>
              <div class="col-6">
              </div>
            </div>

            <div class="row mt-5">
              <div class="col-md-6">
                <div class="form-floating my-3">
                  <input type="text" class="form-control" name="name" id="name" required>
                  <label for="name">Full Name *</label>
                  <span class="text-danger"></span>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating my-3">
                  <input type="text" class="form-control" name="phone" required>
                  <label for="phone">Phone Number *</label>
                  <span class="text-danger"></span>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating my-3">
                  <input type="text" class="form-control" name="house" required>
                  <label for="house"> HouserNo. *</label>
                  <span class="text-danger"></span>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating mt-3 mb-3">
                  <input type="text" class="form-control" name="street" required>
                  <label for="street">StreetNo. *</label>
                  <span class="text-danger"></span>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating my-3">
                  <input type="text" class="form-control" name="area" required>
                  <label for="area">Area Name *</label>
                </div>
              </div>
              <div class="col-md-12">
                <div class="form-floating my-3">
                  <input required type="email" class="form-control" name="email" >
                  <label for="email">Email *</label>
                </div>
              </div>
            </div>
          </div>
          <div class="checkout__totals-wrapper">
            <div class="sticky-content">
              <div class="checkout__totals">
                <h3>Your Order</h3>
                <table class="checkout-cart-items">
                  <thead>
                    <tr>
                      <th>PRODUCT</th>
                      <th>QTY</th>
                      <th align="right">SUBTOTAL</th>
                    </tr>
                  </thead>
                  <tbody id="main_item">
                    <tr>
                      <td>
                        Zessi Dresses x 2
                      </td>
                      <td>
                         x 2
                      </td>
                      <td align="right">
                        $32.50
                      </td>
                    </tr>

                  </tbody>
                </table>
                <table class="checkout-totals">
                  <tbody>
                    <tr>
                      <th>SUBTOTAL</th>
                      <td align="right" id="label_subtotal">$62.40</td>
                    </tr>
                    <tr>
                      <th>DELIVERY</th>
                      <td align="right">Free Delivery</td>
                    </tr>

                    <tr>
                      <th>TOTAL(KHR)</th>
                      <td align="right" id="label_total_kh">$81.40</td>
                    </tr>
                    <tr>
                      <th>TOTAL(USD)</th>
                      <td align="right" id="label_total_usd">$81.40</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="mobile_fixed-btn_wrapper" >
                  <div class="button-wrapper container" >
                      <button class="btn btn-primary btn-checkout">PLACE ORDER</button>
                  </div>
              </div>
            </div>
          </div>
        </div>
          <input type="hidden" id="cart-item" name="cart-item">
      </form>
    </section>
  </main>
{% endblock %}
{% block scriptBlock %}
    <script>
        let main_item = document.getElementById('main_item')
        let carts = JSON.parse(localStorage.getItem('carts') ?? '[]')
        document.getElementById('cart-item').value = JSON.stringify(carts)
        let cart_item = ``
        let total = 0
        carts.forEach((item) => {
            total += (item.price * item.qty)
            cart_item += `
              <tbody>
                <tr>
                  <td>
                    ${item.title}
                  </td>
                  <td>
                     x ${item.qty}
                  </td>
                  <td align="right">
                    $${item.price * item.qty}
                  </td>
                </tr>
              </tbody>
            `
        })
        main_item.innerHTML = cart_item
        document.getElementById('label_subtotal').innerHTML= `$${total.toFixed(2)}`
        document.getElementById('label_total_usd').innerHTML = `$${total.toFixed(2)}`
        document.getElementById('label_total_kh').innerHTML =  `áŸ›${(total*4100).toLocaleString()}`

        localStorage.setItem('carts', JSON.stringify(carts));
    </script>
{% endblock %}